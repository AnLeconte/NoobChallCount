<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NoobChallCount</title>
  <!-- Inclure Bootstrap CSS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .counter {
      margin-bottom: 20px;
    }

    /* Styles pour positionner l'image */
    #dofusEmeraude {
      position: fixed;
      bottom: 10px; /* Ajuster selon votre besoin */
      right: 10px; /* Ajuster selon votre besoin */
      width: 100px; /* Ajuster la taille de l'image */
      height: auto; /* Pour garder les proportions */
      z-index: 1000; /* Assure que l'image soit au-dessus du contenu */
    }

    /* Ajout d'une couleur de fond temporaire pour déboguer */
    body {
      background-color: #f8f9fa; /* Couleur de fond temporaire */
    }

    .container {
      background-color: #ffffff; /* Couleur de fond du conteneur principal */
      padding: 20px; /* Ajouter un peu d'espace autour du contenu */
      margin-top: 20px; /* Ajuster selon votre besoin */
    }

    /* Rétablissement des styles pour le tableau et les textes */
    .table {
      margin-top: 20px; /* Espacement entre le haut du conteneur et le tableau */
    }

    .modal-content {
      background-color: #ffffff; /* Couleur de fond de la modal */
    }

    /* Styles pour positionner les boutons */
    .buttons-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
    }

    .reset-button {
      margin-top: 10px; /* Espacement supplémentaire après les textes de sauvegarde */
    }
  </style>
</head>
<body>
<div class="container">
  <div class="d-flex flex-column align-items-center my-4">
    <h1>Ajouter un noob</h1>
    <div class="d-flex mb-4">
      <input type="text" id="buttonName" placeholder="Nom du noob" class="form-control mr-2">
      <button id="createButton" class="btn btn-primary">Ajouter le noob</button>
    </div>
  </div>

  <table class="table table-striped">
    <thead>
    <tr>
      <th>Nom du noob</th>
      <th>Challenges foirés</th>
      <th>+1</th>
    </tr>
    </thead>
    <tbody id="countersContainer"></tbody>
  </table>

  <!-- Bouton Enregistrer -->
  <div class="text-right">
    <button id="saveButton" class="btn btn-success">Enregistrer</button>
  </div>

  <!-- Textes de sauvegarde -->
  <div id="saveText" class="mt-3"></div>

  <!-- Bouton Réinitialiser les sauvegardes -->
  <div class="reset-button">
    <button id="resetButton" class="btn btn-danger">Réinitialiser les sauvegardes</button>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Sauvegarde réussie</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Le plus gros noob est : <span id="topNoobName"></span> avec <span id="topNoobCount"></span> challenges foirés.</p>
          <p>Date de sauvegarde : <span id="saveDate"></span></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Image de Dofus Émeraude -->
  <img id="dofusEmeraude" src="img/dfs02-emeraude_orig.png" alt="Dofus Émeraude">
</div>

<!-- Inclure Bootstrap JS et ses dépendances -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
  let counterId = 1; // Identifiant pour les compteurs
  const countersContainer = document.getElementById('countersContainer');
  const createButton = document.getElementById('createButton');
  const saveButton = document.getElementById('saveButton');
  const resetButton = document.getElementById('resetButton');
  const saveTextContainer = document.getElementById('saveText');

  let counters = []; // Tableau pour stocker les compteurs
  let savedRecords = []; // Tableau pour stocker les enregistrements sauvegardés

  // Charger les enregistrements depuis localStorage s'ils existent
  if (localStorage.getItem('savedRecords')) {
    savedRecords = JSON.parse(localStorage.getItem('savedRecords'));
    displaySavedRecords();
  }

  createButton.addEventListener('click', () => {
    const buttonName = document.getElementById('buttonName').value;
    if (buttonName.trim() === '') {
      alert('Veuillez entrer un nom pour le noob.');
      return;
    }
    addCounter(buttonName);
    document.getElementById('buttonName').value = ''; // Réinitialiser le champ de saisie
  });

  saveButton.addEventListener('click', () => {
    const maxCount = Math.max(...counters.map(counter => counter.count));
    const topCounter = counters.find(counter => counter.count === maxCount);
    const currentDate = new Date().toLocaleString(); // Obtenir la date actuelle

    // Créer un nouvel enregistrement
    const record = {
      name: topCounter.name,
      count: topCounter.count,
      date: currentDate
    };

    // Ajouter l'enregistrement au tableau des enregistrements
    savedRecords.push(record);

    // Sauvegarder les enregistrements dans localStorage
    localStorage.setItem('savedRecords', JSON.stringify(savedRecords));

    // Afficher le dernier enregistrement sauvegardé
    document.getElementById('topNoobName').textContent = record.name;
    document.getElementById('topNoobCount').textContent = record.count;
    document.getElementById('saveDate').textContent = record.date;
    $('#exampleModal').modal('show'); // Afficher la modal

    // Afficher tous les enregistrements sauvegardés
    displaySavedRecords();
  });

  resetButton.addEventListener('click', () => {
    // Réinitialiser les sauvegardes visuelles
    saveTextContainer.innerHTML = '';
    // Réinitialiser le tableau des enregistrements
    savedRecords = [];
    // Supprimer les sauvegardes du localStorage
    localStorage.removeItem('savedRecords');
  });

  function displaySavedRecords() {
    saveTextContainer.innerHTML = ''; // Effacer le contenu actuel

    savedRecords.forEach(record => {
      const saveText = document.createElement('p');
      saveText.textContent = `Sauvegarde pour ${record.name} : ${record.count} challenges foirés, le ${record.date}`;
      saveTextContainer.appendChild(saveText);
    });
  }

  function addCounter(buttonName) {
    // Créer les éléments pour un nouveau compteur
    const counterRow = document.createElement('tr');

    const nameCell = document.createElement('td');
    nameCell.textContent = buttonName;

    const countCell = document.createElement('td');
    const countP = document.createElement('p');
    const countId = 'count' + counterId;
    countP.id = countId;
    countP.textContent = '0';
    countCell.appendChild(countP);

    const actionCell = document.createElement('td');
    const addButton = document.createElement('button');
    addButton.textContent = '+1';
    addButton.id = 'addButton' + counterId;
    addButton.classList.add('btn', 'btn-secondary');
    actionCell.appendChild(addButton);

    // Ajouter les cellules à la ligne
    counterRow.appendChild(nameCell);
    counterRow.appendChild(countCell);
    counterRow.appendChild(actionCell);

    // Ajouter la ligne au tableau
    countersContainer.appendChild(counterRow);

    // Ajouter le compteur à la liste des compteurs
    counters.push({ id: counterId, name: buttonName, count: 0 });

    // Ajouter un écouteur d'événement pour incrémenter le compteur
    addButton.addEventListener('click', () => {
      // Extraire l'ID du bouton à partir de son ID
      const id = parseInt(addButton.id.replace('addButton', ''));
      // Trouver le compteur correspondant dans le tableau
      const counterIndex = counters.findIndex(counter => counter.id === id);
      // Incrémenter le compteur
      counters[counterIndex].count++;
      // Mettre à jour le texte du compteur
      document.getElementById('count' + id).textContent = counters[counterIndex].count.toString();
    });

    // Incrémenter l'identifiant pour le prochain compteur
    counterId++;
  }
</script>
</body>
</html>
